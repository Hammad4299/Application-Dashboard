{"version":3,"sources":["webpack:///./resources/assets/js/entrypoints/moneymaker/user.js","webpack:///./resources/assets/js/specific/moneymaker/user.ts","webpack:///./resources/assets/js/specific/moneymaker/Piwik/MoneyMakerPiwikHelper.ts","webpack:///./resources/assets/js/Piwik/ReportingApiHelper.ts"],"names":[],"mappings":"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","file":"js/app/moneymaker/user.js","sourcesContent":["require('../../../sass/moneymaker.scss');\r\nrequire('../../specific/moneymaker/user');\n\n\n// WEBPACK FOOTER //\n// ./node_modules/source-map-loader!./resources/assets/js/entrypoints/moneymaker/user.js","import {default as moneymaker} from './common';\r\nimport global from \"../../globals\";\r\nimport MoneyMakerPiwikHelper, {VisitsActivity, FlattenedActionData} from \"./Piwik/MoneyMakerPiwikHelper\";\r\nimport DataTable = DataTables.Api;\r\ndeclare var flatpickr:any;\r\nimport moment = require(\"moment\");\r\ndeclare var window:any;\r\n\r\nlet piwikHelper = new MoneyMakerPiwikHelper();\r\n\r\n{\r\n    let screensTable:DataTable = null;\r\n    let eventsTable:DataTable = null;\r\n    let uid:any = null;\r\n    function loadDataInDatatable(data:VisitsActivity,container:JQuery):void{\r\n        const visitedScreens = data.getVisitScreens();\r\n        let screensData:FlattenedActionData[] = [];\r\n        let map:any = {};\r\n\r\n        visitedScreens.map((screen:FlattenedActionData)=>{\r\n            let toIns = new FlattenedActionData();\r\n            if(map[screen.actionName]){\r\n                toIns = map[screen.actionName];\r\n            }else{\r\n                toIns.actionName = screen.actionName;\r\n                toIns.duration = 0;\r\n                toIns.timestamp = screen.timestamp;\r\n                screensData.push(toIns);\r\n                map[screen.actionName] = toIns;\r\n            }\r\n\r\n            //console.log(screen.actionName);\r\n            console.log(screen.duration);\r\n            //console.log(toIns.duration);\r\n            toIns.duration = toIns.duration+screen.duration;\r\n        });\r\n\r\n        console.log(map);\r\n\r\n\r\n        if(screensTable!=null){\r\n            screensTable.destroy();\r\n        }\r\n        screensTable = container.find('.js-screens-table').DataTable( {\r\n            data: screensData,\r\n            pageLength: 10,\r\n            searching: false,\r\n            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, \"All\"]],\r\n            columns: [\r\n                { title: \"Screen Name\", data: \"actionName\" },\r\n                { title: \"Visited At\", data: \"timestampFormatted\" },\r\n                { title: \"Duration\", data: \"durationFormatted\" }\r\n            ]\r\n        } );\r\n\r\n\r\n        if(eventsTable!=null){\r\n            eventsTable.destroy();\r\n        }\r\n\r\n        eventsTable = container.find('.js-events-table').DataTable( {\r\n            data: data.getFlattenedEvents(),\r\n            pageLength: 50,\r\n            searching: false,\r\n            lengthMenu: [[50, 100, 200, -1], [50, 100, 200, \"All\"]],\r\n            columns: [\r\n                { title: \"Action Name\", data: \"actionName\" },\r\n                { title: \"Timestamp\",data: \"timestampFormattedWithTime\" },\r\n                { title: \"Value\",data: \"eventValue\" },\r\n            ]\r\n        } );\r\n    }\r\n\r\n    $(document).on('click','.js-analytics-by-date',function () {\r\n        let dateElem = $(this).parent().find('.js-flatpickr');\r\n        let startdate = (<string>dateElem.val()).split(' to ')[0];\r\n        let enddate = (<string>dateElem.val()).split(' to ')[1];\r\n        if(startdate == \"\" || enddate == \"\"){\r\n            return false;\r\n        }\r\n        const modal = $('#myModal');\r\n        piwikHelper.getUserAnalyticDetail(uid,startdate,enddate, (data:VisitsActivity) => {\r\n            loadDataInDatatable(data,modal);\r\n        });\r\n    });\r\n\r\n    $(document).on('click','.js-analytics-detail',function () {\r\n        let elem:any = $(this);\r\n        let email = elem.parents('tr').find('td').eq(3).text();\r\n        let username = elem.parents('tr').find('td').eq(0).text();\r\n        uid = $(this).attr('data-uid');\r\n        const modal = $('#myModal');\r\n        modal.find('.js-username').text(username);\r\n        modal.find('.js-email').text(email);\r\n\r\n        let flatPickr:any = (<any>modal.find('.js-flatpickr')[0])._flatpickr;\r\n        flatPickr.setDate([\r\n            moment().toDate(),moment().add(-1,'month').toDate()\r\n        ],true);\r\n        modal.find('.js-analytics-by-date').trigger('click');\r\n        $('#myModal').modal('show');\r\n    });\r\n}\r\n\r\n\r\n$(document).on('click','.js-user-block,.js-user-unblock',function(){\r\n    let url = global.ajaxUrls.moneymakerUserStateUrl;\r\n    let button = $(this);\r\n    url = moneymaker.replaceUrlParams(url,button,'user-id');\r\n    let state=button.data('state');\r\n\r\n    let fD=new FormData();\r\n    fD.append('state',state);\r\n\r\n    $.siteAjax({\r\n        url: url,\r\n        method: 'post',\r\n        processData: false,\r\n        contentType: false,\r\n        data: fD,\r\n        success: function (data:any) {\r\n            if ((typeof data) == 'string')\r\n                data = JSON.parse(data);\r\n\r\n            if(state==1) {\r\n                button.html('Unblock');\r\n                button.data('state', 2);\r\n                button.removeClass('js-user-block btn-danger');\r\n                button.addClass('js-user-unblock btn-primary');\r\n            }\r\n            else\r\n            {\r\n                button.html('Block');\r\n                button.data('state', 1);\r\n                button.removeClass('js-user-unblock btn-primary');\r\n                button.addClass('js-user-block btn-danger');\r\n            }\r\n        },\r\n    });\r\n});\r\n\r\n$(document).on('click','.js-user-delete',function(){\r\n    let url = global.ajaxUrls.moneymakerUserDeleteUrl;\r\n    let button = $(this);\r\n\r\n    url =moneymaker.replaceUrlParams(url,button,'user-id');\r\n    $.siteAjax({\r\n        url: url,\r\n        method: 'delete',\r\n        contentType: false,\r\n        success: function (data:any) {\r\n            if ((typeof data) == 'string')\r\n                data = JSON.parse(data);\r\n\r\n            button.parents('tr').remove();\r\n        },\r\n    });\r\n});\n\n\n// WEBPACK FOOTER //\n// ./resources/assets/js/specific/moneymaker/user.ts","import {\r\n    LastVisitsDetailRequest,\r\n    PiwikHelper, Segment, UserIdRequest,\r\n    VisitorProfileRequest\r\n} from \"../../../Piwik/ReportingApiHelper\";\r\nimport global from \"../../../globals\";\r\nimport * as moment from \"moment\";\r\n\r\n\r\n\r\n\r\n/**\r\n * Created by talha on 9/25/2017.\r\n */\r\n\r\n\r\n\r\nexport class VisitsActivity{\r\n    protected flattenedScreens:FlattenedActionData[];\r\n    protected flattenedEvents:FlattenedActionData[];\r\n\r\n    public getVisitScreens(){\r\n        return this.flattenedScreens;\r\n    }\r\n\r\n    public getFlattenedEvents(){\r\n        return this.flattenedEvents;\r\n    }\r\n\r\n    constructor(visits:any){\r\n        this.processResponse(visits);\r\n    }\r\n\r\n    protected processResponse(visits:any){\r\n        this.flattenedEvents = [];\r\n        const self = this;\r\n        this.flattenedScreens = [];\r\n        let timeOnScreens:any = {};\r\n        let remainingScreensApproxAvg:FlattenedActionData[] = [];\r\n\r\n        visits.map((visit:any) => {\r\n            let pre:FlattenedActionData = null;\r\n            visit.actionDetails.map((action:any) => {\r\n                let toIns = new FlattenedActionData();\r\n                toIns.visitId = visit.idVisit;\r\n                toIns.visitIp = visit.visitIp;\r\n                toIns.visitorId = visit.visitorId;\r\n                toIns.type = action.type;\r\n                toIns.timestamp = action.timestamp;\r\n                toIns.idpageview = action.idpageview;\r\n                if(toIns.type == '4'){\r\n                    toIns.actionName = action.pageTitle;\r\n\r\n                    if(pre!=null) {\r\n                        pre.duration = toIns.timestamp - pre.timestamp;\r\n                        if(!timeOnScreens[pre.actionName]){\r\n                            timeOnScreens[pre.actionName] = {count: 0,duration: 0};\r\n                        }\r\n\r\n                        timeOnScreens[pre.actionName].duration += pre.duration;\r\n                        timeOnScreens[pre.actionName].count++;\r\n                    }\r\n\r\n                    pre = toIns;\r\n                    self.flattenedScreens.push(toIns);\r\n                }else{\r\n                    toIns.actionName = action.eventName;\r\n                    toIns.actionPerformed = action.eventAction;\r\n                    toIns.eventValue = action.eventValue;\r\n                    toIns.eventCategory = action.eventCategory;\r\n                    self.flattenedEvents.push(toIns);\r\n                }\r\n            });\r\n\r\n            if(pre!=null)\r\n                remainingScreensApproxAvg.push(pre);\r\n        });\r\n\r\n        remainingScreensApproxAvg.map((d)=>{\r\n            if(timeOnScreens[d.actionName]){\r\n                d.duration = Math.floor(timeOnScreens[d.actionName].duration/timeOnScreens[d.actionName].count);\r\n                timeOnScreens[d.actionName].count++;\r\n                timeOnScreens[d.actionName].duration += d.duration;\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport class FlattenedActionData{\r\n    public actionName:string;\r\n    public actionPerformed:string;\r\n    public eventCategory:string;\r\n    public idpageview:string;\r\n    public visitId:string;\r\n    public visitIp:string;\r\n    public visitorId:string;\r\n    public type:string;\r\n    public timestamp:number;\r\n    public duration:number;\r\n    protected _eventValue:number;\r\n    public get eventValue():number{\r\n        return this._eventValue ? this._eventValue : null;\r\n    }\r\n    public set eventValue(value:number){\r\n        this._eventValue = value;\r\n    }\r\n    get timestampFormatted():string{\r\n        return global.timeHelper.convertUtcToUserTime(this.timestamp.toString(),'X').format('YYYY-MM-DD');\r\n    }\r\n    get timestampFormattedWithTime():string{\r\n        return global.timeHelper.convertUtcToUserTime(this.timestamp.toString(),'X').format('YYYY-MM-DD hh:mm:ss a');\r\n    }\r\n    get durationFormatted():string{\r\n        return moment.duration(this.duration,'s').humanize();\r\n    }\r\n}\r\n\r\n\r\nexport default class MoneyMakerPiwikHelper extends PiwikHelper{\r\n    protected userIdToVisitorMap:any;\r\n    constructor(){\r\n        super();\r\n        this.userIdToVisitorMap = {};\r\n    }\r\n    protected getVisitor(userId:string, callback:(id:string|null)=>any){\r\n        if(this.userIdToVisitorMap[userId]){\r\n            callback(this.userIdToVisitorMap[userId]);\r\n        }else{\r\n            let self = this;\r\n            let r = new UserIdRequest(this.config);\r\n            let segment = new Segment();\r\n            segment.and('userId','==',userId);\r\n            r.setSegment(segment);\r\n            this.executeRequest(r,function (d:any) {\r\n                if(d.length>0)\r\n                    self.userIdToVisitorMap[userId] = d[0];\r\n\r\n                callback(self.userIdToVisitorMap[userId]);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected static getVisitorId(visitor:any):string{\r\n        if(visitor)\r\n            return visitor.idvisitor;\r\n\r\n        return null;\r\n    }\r\n\r\n    public getUserAnalyticDetail(userId:string,startDate:string,endDate:string,callback:(d:VisitsActivity) => any){\r\n        let r = new LastVisitsDetailRequest(this.config);\r\n        let s = new Segment();\r\n        s.and('userId','==',userId);\r\n        r.setSegment(s);\r\n        r.setDateRange(startDate,endDate);\r\n        this.executeRequest(r,function (d:any) {\r\n            callback(new VisitsActivity(d));\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./resources/assets/js/specific/moneymaker/Piwik/MoneyMakerPiwikHelper.ts","\r\nimport global from \"../globals\";\r\nimport TimeHelper from \"../Utility/time\";\r\n/**\r\n * Created by talha on 9/25/2017.\r\n */\r\ndeclare var $:any;\r\n\r\n\r\nexport enum DatePeriod{\r\n    Range = 'range',\r\n    Year = 'year',\r\n    Month = 'month',\r\n    Week = 'week',\r\n    Day = 'day'\r\n}\r\n\r\nexport class Segment{\r\n    protected data:any;\r\n    constructor(){\r\n        this.data = [];\r\n    }\r\n    public and(name:string,operator:string,value:string){\r\n        this.data.push({\r\n            name: name,\r\n            operator: operator,\r\n            condition:';',\r\n            value: value\r\n        });\r\n    }\r\n    public or(name:string,operator:string,value:string){\r\n        this.data.push({\r\n            name: name,\r\n            operator: operator,\r\n            condition:',',\r\n            value: value\r\n        });\r\n    }\r\n    public build():string{\r\n        let first = true;\r\n        let str = '';\r\n        this.data.map(function (part:any) {\r\n            if(!first)\r\n                str += part.condition;\r\n            str += `${part.name}${part.operator}${part.value}`;\r\n            first = false;\r\n        });\r\n        return str;\r\n    }\r\n}\r\n\r\nexport class PiwikConfig{\r\n    protected siteId:string;\r\n    protected authToken:string;\r\n    protected baseUrl:string;\r\n    protected timeOffset:number;\r\n    constructor(){\r\n        this.siteId = $('#piwik-info').attr('data-site-id');\r\n        this.authToken = $('#piwik-info').attr('data-auth-token');\r\n        this.baseUrl = $('#piwik-info').attr('data-base-url');\r\n        this.timeOffset = 0;\r\n    }\r\n    public getBaseUrl(){\r\n        return this.baseUrl;\r\n    }\r\n    public getAuthToken(){\r\n        return this.authToken;\r\n    }\r\n    public getTimeOffset(){\r\n        return this.timeOffset;\r\n    }\r\n    public getSiteId(){\r\n        return this.siteId;\r\n    }\r\n}\r\n\r\nexport abstract class ReportingRequest{\r\n    protected data:any;\r\n    protected config:PiwikConfig;\r\n    public setSegment(s:Segment){\r\n        this.data.segment = s.build();\r\n    }\r\n    public setDateRange(userStartDate:string,userEndDate:string){\r\n        this.data.period = DatePeriod.Range;\r\n        const userOffset = global.timeHelper.getUserUtcOffset();\r\n        const start = TimeHelper.convertTimeToDifferentZone(userStartDate + ' 00:00:00','YYYY-MM-DD HH:mm:ss',userOffset,this.config.getTimeOffset());\r\n        const end = TimeHelper.convertTimeToDifferentZone(userEndDate + ' 23:59:59','YYYY-MM-DD HH:mm:ss',userOffset,this.config.getTimeOffset());\r\n        this.data.date = `${start.format('YYYY-MM-DD')},${end.format('YYYY-MM-DD')}`;\r\n    }\r\n    public setDate(date:string,period:DatePeriod){\r\n        this.data.period = period;\r\n        const userOffset = global.timeHelper.getUserUtcOffset();\r\n        this.data.date = TimeHelper.convertTimeToDifferentZone(date + ' 12:00:00','YYYY-MM-DD HH:mm:ss',userOffset,this.config.getTimeOffset()).format('YYYY-MM-DD');\r\n    }\r\n    constructor(config:PiwikConfig,data?:any){\r\n        this.config = config;\r\n        this.data = {};\r\n        this.setDate(global.timeHelper.userTime().format('YYYY-MM-DD'),DatePeriod.Year);\r\n        if(data){\r\n            for(let i in data){\r\n                if(data.hasOwnProperty(i))\r\n                    this.data[i] = data[i];\r\n            }\r\n        }\r\n\r\n    }\r\n    abstract getMethodName():string;\r\n    public getData(){\r\n        return this.data;\r\n    }\r\n}\r\n\r\nexport class UserIdRequest extends ReportingRequest{\r\n    getMethodName(): string {\r\n        return 'UserId.getUsers';\r\n    }\r\n}\r\n\r\nexport class VisitorProfileRequest extends ReportingRequest{\r\n    public setVisitorId(id:string){\r\n        this.data.visitorId = id;\r\n    }\r\n    getMethodName(): string {\r\n        return 'Live.getVisitorProfile';\r\n    }\r\n}\r\n\r\nexport class LastVisitsDetailRequest extends ReportingRequest{\r\n    getMethodName(): string {\r\n        return 'Live.getLastVisitsDetails';\r\n    }\r\n}\r\n\r\nexport class PiwikHelper{\r\n    public config:PiwikConfig;\r\n    constructor(){\r\n        this.config = new PiwikConfig();\r\n    }\r\n    public executeRequest(request:ReportingRequest,callback:any){\r\n        let d = request.getData();\r\n        d.method = request.getMethodName();\r\n        d.module = 'API';\r\n        d.idSite = this.config.getSiteId();\r\n        d.token_auth = this.config.getAuthToken();\r\n        d.format = 'json';\r\n        $.ajax({\r\n            type: 'get',\r\n            data: d,\r\n            url: this.config.getBaseUrl(),\r\n            success: function (da:any) {\r\n                callback(da);\r\n            }\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./resources/assets/js/Piwik/ReportingApiHelper.ts"],"sourceRoot":""}